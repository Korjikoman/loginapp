{% extends 'app/base.html' %}
{% load static %}
{% load crispy_forms_tags %}
{% block content %}
<h2>Upload file</h2>

<form method="post", enctype="multipart/form-data">
    {% csrf_token %}
    {{ AudioForm | crispy }}
    <div class="d-grid gap-3 mt-3">
        <button type="submit" class="btn btn-outline-success">Upload audio</button>
    </div>
</form>
    
<p>Your file size :</p>
{{ size|filesizeformat }}
{{ size }}
<h2>Transcript</h2>

{% if error %}
    <p id="error" style="color: red">{{ error }}</p>
{% endif %}
<p id="app">
    
    {{ text }}

</p>

{% comment %} <script src="{% static 'recog.js' %}"></script> {% endcomment %}
<script>
    const socket = new WebSocket('ws://' + window.location.host + '/ws/transcribe_audio/');

    socket.onmessage = function (event) {
        const data = JSON.parse(event.data);
        console.log(data.message);
        document.querySelector('#app').innerText = data.message
    };
</script>
{% endblock %}